package com.example.jaxrs;


import java.io.IOException;
import java.io.UnsupportedEncodingException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

import javax.ws.rs.client.ClientBuilder;
import javax.ws.rs.client.Entity;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.MultivaluedHashMap;

import com.fasterxml.jackson.core.JsonParseException;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.ObjectMapper;
public class Main {
	/*
	 * アプリケーションID：	
		dj0zaiZpPVRONUFDSFBZZkdQaiZzPWNvbnN1bWVyc2VjcmV0Jng9YWY-
	シークレット：
		344ea58543e3a7404e484b7772a69555288e6c73

	 */

	public static void main(String[] args) {
		// TODO Auto-generated method stub
		MultivaluedHashMap<String, String> formParams = new MultivaluedHashMap<String,String>();
        formParams.putSingle("sentence", "東京ミッドタウンから国立新美術館まで歩いて5分で着きます。");
        formParams.putSingle("output", "json");
        EnDto en = new EnDto();
        MultivaluedHashMap<String,EnDto> setParams = new MultivaluedHashMap<String,String>();
        setParams.putSingle("coordinates", en.setCoordinates("35.663613,139.732293");
        setParams.putSingle("output", "json");
        setParams.putSingle("callback", "UTF-8");
        

        String result = ClientBuilder.newClient()
                .target("http://jlp.yahooapis.jp")
                .path("KeyphraseService/V1/extract")
                .request(MediaType.APPLICATION_JSON_TYPE )
                .header("User-Agent", "Yahoo AppID:dj0zaiZpPVRONUFDSFBZZkdQaiZzPWNvbnN1bWVyc2VjcmV0Jng9YWY-")
                .post(Entity.entity(formParams, MediaType.APPLICATION_FORM_URLENCODED_TYPE), String.class);
     
        // 標準出力にレスポンスを表示
       
        ObjectMapper mapper = new ObjectMapper();
        Map<String, Object> map = new HashMap<String, Object>();
     // convert JSON string to Map
        try {
			map = mapper.readValue(result, new TypeReference<Map<String, String>>(){});
			System.out.println(map);
			System.out.println(map.get("東京ミッドタウン"));
		} catch (JsonParseException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (JsonMappingException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}


	}
	/**
	 * Unicode文字列から元の文字列に変換する ("\u3042" -> "あ")
	 * @param unicode
	 * @return
	 */
	private static String convertToOiginal(String unicode)
	{
	    String[] codeStrs = unicode.split("\\\\u");
	    int[] codePoints = new int[codeStrs.length - 1]; // 最初が空文字なのでそれを抜かす
	    for (int i = 0; i < codePoints.length; i++) {
	        codePoints[i] = Integer.parseInt(codeStrs[i + 1], 16);
	    }
	    String encodedText = new String(codePoints, 0, codePoints.length);
	    return encodedText;
	}

}
